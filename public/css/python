import sys
import cv2
import numpy as np
import json

# Simple example: Detect 'acne' via red spots (placeholder; use CNN for real)
def analyze_skin(image_path):
    img = cv2.imread(image_path)
    if img is None:
        return {'error': 'Invalid image'}
    
    # Convert to HSV for color detection
    hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)
    # Red range for acne (simplified)
    lower_red = np.array([0, 50, 50])
    upper_red = np.array([10, 255, 255])
    mask1 = cv2.inRange(hsv, lower_red, upper_red)
    lower_red = np.array([170, 50, 50])
    upper_red = np.array([180, 255, 255])
    mask2 = cv2.inRange(hsv, lower_red, upper_red)
    mask = mask1 + mask2
    
    red_percentage = (np.sum(mask > 0) / (img.shape[0] * img.shape[1])) * 100
    conditions = []
    if red_percentage > 5:  # Arbitrary threshold
        conditions.append('acne')
    # Add more for dryness, etc. (e.g., texture analysis)
    
    return {'conditions': conditions}

if __name__ == "__main__":
    image_path = sys.argv[1]
    result = analyze_skin(image_path)
    print(json.dumps(result))